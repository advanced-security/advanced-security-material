# CodeQL using Bazel

[Bazel](https://bazel.build/) is a build system used by some enterprises over other compilers to make their builds faster and scalable.
Due to some of the features of Bazel, this does cause issues with analysing the build using CodeQL but this guide will describe some of the requirements needed to analyse the code correctly.


## Solution

There are three major parts to making sure CodeQL analyses Bazel builds correctly.

```bash
# This stops all running Bazel server processes
bazel shutdown 

# This makes sure that Bazel doesn't use cached objects before building
bazel clean --expunge

# This builds the code with:
# * --spawn_strategy=local : a local build strategy verses a distributed system
# * --nouse_action_cache : prevents build caching that might prevent recompilation of source code 
bazel build --spawn_strategy=local --nouse_action_cache //:app
```

Here are example(s) of how this can be done:

- [Java application using Bazel](https://github.com/affrae/quickjavahelloworld) by @affrae


## FAQ from customers

#### `Can I build in parallel across different machines?`

Sadly we do not support cross-machine compiling due to the fact CodeQL needs to hook into the build process and then create the TRAP files for each compiled component.


#### `Can I use Bazel caching?`

We do not currently support caching in an easy to use way. This requires maintaining a cached copy of the [TRAP files](https://codeql.github.com/docs/codeql-overview/codeql-glossary/#trap-file) generated by CodeQL from previous Bazel builds, knowing which part is associated with which and which parts need to be newly created.
If this is something the customer wants, this will require Services hours and Engineering to assist with.


## References
- [TRAP files](https://codeql.github.com/docs/codeql-overview/codeql-glossary/#trap-file)
